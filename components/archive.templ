package components

import (
	"fmt"
	"github.com/yulog/mi-diary/model"
)

type ArchiveParams struct {
	Title   string
	Profile string
	Items   []model.Day
}

var header = ""
var isOpen = false

func setHeader(h string) (string, error) {
	header = h
	return "", nil
}

func setIsOpen(f bool) (string, error) {
	isOpen = f
	return "", nil
}

templ (p ArchiveParams) Archive() {
	@BaseWithNav(p.Title, p.Profile) {
		<div class="content">
			for _, item := range p.Items {
				if header != item.Month.YM && isOpen {
					{ setIsOpen(false) }
					@templ.Raw("</ul>")
				}
				if header != item.Month.YM {
					{ setHeader(item.Month.YM) }
					<a href={ templ.URL(fmt.Sprintf("/profiles/%s/archives/%s", p.Profile, item.Month.YM)) }>
						<h3>{ item.Month.YM } ( { fmt.Sprintf("%d", item.Month.Count) } )</h3>
					</a>
				}
				if !isOpen {
					{ setIsOpen(true) }
					@templ.Raw("<ul>")
				}
				<li>
					<a href={ templ.URL(fmt.Sprintf("/profiles/%s/archives/%s", p.Profile, item.YMD)) }>
						{ item.YMD } ( { fmt.Sprintf("%d", item.Count) } )
					</a>
				</li>
			}
			if isOpen {
				@templ.Raw("</ul>")
			}
			{ setHeader("") }
		</div>
	}
}
